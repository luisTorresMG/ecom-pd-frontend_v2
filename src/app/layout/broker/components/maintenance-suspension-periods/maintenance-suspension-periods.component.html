<title></title>
<link href="http://cdn-na.infragistics.com/igniteui/2021.2/latest/css/themes/infragistics/infragistics.theme.css"
      rel="stylesheet" />
<link href="http://cdn-na.infragistics.com/igniteui/2021.2/latest/css/structure/infragistics.css"
      rel="stylesheet" />
<script src="http://ajax.aspnetcdn.com/ajax/modernizr/modernizr-2.8.3.js"></script>
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="http://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>
<script src="http://cdn-na.infragistics.com/igniteui/2021.2/latest/js/infragistics.core.js"></script>
<script src="http://cdn-na.infragistics.com/igniteui/2021.2/latest/js/infragistics.lob.js"></script>
<script type="text/javascript">function metchec(nom) { alert(nom); nom.checked = checked; }</script>
<div class="row">
    <div class="col-lg-3">
        <app-nav-menuprod></app-nav-menuprod>
    </div>
    <div class="col-lg-9">
        <div class="header-content">
            <div class="containt-item">
                <div class="header-item">
                    <span class="title">SUSPENSIÓN DE FACTURACIÓN/CONVENIO</span>
                </div>
            </div>
        </div>
        <div class="row"
             [formGroup]="filterForm">

            <div class="col-sm-2">
                <span>RAMO</span>
                <select class="form-control"
                        formControlName="P_NBRANCH"
                        [ngClass]="{'error-validate': submitted && (!filterForm.controls.P_NBRANCH.valid || filterForm.hasError('required'))}">

                    <option value="0">TODOS</option>
                    <option *ngFor="let item of ramos.result"
                            value="{{ item.BRANCH }}">{{ item.DESCRIPT }}</option>
                </select>
                <ng-container [ngSwitch]="true"
                              *ngIf="submitted && (!filterForm.controls.P_NBRANCH.valid || filterForm.hasError('required')) && !filterForm.valid">
                    <span *ngSwitchCase="filterForm.get('P_NBRANCH').hasError('required')"
                          class="mensaje-error-control">
                        El Ramo es requerido.
                    </span>
                </ng-container>
            </div>

            <div class="col-sm-2">
                <span>MES</span>
                <select class="form-control"
                        formControlName="P_SMONTH"
                        [ngClass]="{'error-validate': submitted && (!filterForm.controls.P_SMONTH.valid || filterForm.hasError('required'))}">
                    <option value=0>TODOS</option>
                    <option *ngFor="let item of Months"
                            value="{{ item.mes }}">{{ item.descripcion }}</option>
                </select>
                <ng-container [ngSwitch]="true"
                              *ngIf="submitted && (!filterForm.controls.P_SMONTH.valid || filterForm.hasError('required')) && !filterForm.valid">
                    <span *ngSwitchCase="filterForm.get('P_SMONTH').hasError('required')"
                          class="mensaje-error-control">
                        El Mes es requerido.
                    </span>
                </ng-container>
            </div>

            <div class="col-sm-2">
                <span>AÑO</span>
                <input type="text"
                       formControlName="P_SYEAR"
                       placeholder="Selecciona un año de búsqueda"
                       bsDatepicker
                       [ngClass]="{'error-validate': submitted && (!filterForm.controls.P_SYEAR.valid || filterForm.hasError('required'))}"
                       [bsConfig]="bsConfigYear">

                <ng-container [ngSwitch]="true"
                              *ngIf="submitted && (!filterForm.controls.P_SYEAR.valid || filterForm.hasError('required')) && !filterForm.valid">
                    <span *ngSwitchCase="filterForm.get('P_SYEAR').hasError('required')"
                          class="mensaje-error-control">
                        El año es requerido.
                    </span>
                </ng-container>
            </div>
            <div class="col-sm-2">
                <span>&nbsp;</span>
            </div>

            <div class="col-sm-2">
                <span>&nbsp;</span>
                <button class="rounded full-color"
                        (click)="GetListSuspensionesAvailable()">
                    <span>BUSCAR</span>
                </button>
            </div>
            <div class="col-sm-2">
                <span>&nbsp;</span>
                <button class="rounded full-color"
                        (click)="AbrirModal()">
                    <span>AGREGAR</span>
                </button>
            </div>

        </div>
        <div class="card">
            <div class="row m-2">
                <div class="grid form-group">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr class="grid-title">
                                    <td class="grid-title-item text-center">RAMO</td>
                                    <td class="grid-title-item text-center">MES</td>
                                    <td class="grid-title-item text-center">AÑO</td>
                                    <td class="grid-title-item text-center">FECHA INICIO</td>
                                    <td class="grid-title-item text-center">HORA</td>
                                    <td class="grid-title-item text-center">FECHA FIN</td>
                                    <td class="grid-title-item text-center">HORA</td>
                                    <td class="grid-title-item text-center">ESTADO</td>
                                    <td class="grid-title-item text-center"></td>
                                </tr>
                            </thead>
                            <ng-container
                                          *ngIf="DataSuspension==null || DataSuspension.RESULT.length==0; then hideGrid1 else showGrid1"></ng-container>
                        </table>
                        <ng-template #hideGrid1>
                            <tbody>
                                <tr>
                                    <td class="text-center"
                                        colspan="10">No se encontraron registros.</td>
                                </tr>
                            </tbody>
                        </ng-template>
                        <ng-template #showGrid1>
                            <tbody *ngFor="let item of pagedResult"
                                   style="cursor: pointer;">
                                <tr>
                                    <td class="data-table-tr-td text-center">
                                        {{ item.BRANCH }}
                                    </td>
                                    <td class="data-table-tr-td text-center">
                                        {{ item.DESC_MONTH }}
                                    </td>
                                    <td class="data-table-tr-td text-center">
                                        {{ item.YEAR }}
                                    </td>
                                    <td class="data-table-tr-td text-center">
                                        {{ item.DSTART_DATE }}
                                    </td>
                                    <td class="data-table-tr-td text-center">
                                        {{ item.DSTART_HOUR }}
                                    </td>
                                    <td class="data-table-tr-td text-center">
                                        {{ item.DEND_DATE }}
                                    </td>
                                    <td class="data-table-tr-td text-center">
                                        {{ item.DEND_HOUR }}
                                    </td>
                                    <td class="data-table-tr-td text-center">
                                        {{ item.STATUS }}
                                    </td>
                                    <td class="data-table-tr-td text-center">
                                        <div>
                                            <a *ngIf="item.NSTATUS == 1 "
                                               (click)="AbrirModal(item.NID, item)"><img alt="ver"
                                                     src="assets/icons/editar.png"
                                                     title="Editar"
                                                     style="cursor: pointer;height: 24px;width: 24px"></a>
                                            <a (click)="CloseDeleteSuspension(true, item)"
                                               style="margin-left:2px;"><img alt="ver"
                                                     src="assets/icons/anular.png"
                                                     title="Eliminar"
                                                     style="cursor: pointer;height: 24px;width: 24px"></a>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </ng-template>
                    </div>
                </div>
                <div *ngIf="DataSuspension!=null && DataSuspension.RESULT.length>0"
                     class="row"
                     style="display:flex">
                    <div class="col-sm-12">
                        <ngb-pagination [(page)]="currentPage"
                                        [pageSize]="itemsPerPage"
                                        [collectionSize]="totalItems"
                                        [maxSize]="maxSize"
                                        (pageChange)="pageChanged($event)">
                            <ng-template ngbPaginationPrevious>ANTERIOR</ng-template>
                            <ng-template ngbPaginationNext>SIGUIENTE</ng-template>
                        </ngb-pagination>


                    </div>
                </div>
            </div>
        </div>
    </div>

    <div bsModal
         #childModalMensaje="bs-modal"
         class="modal fade"
         tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg w-75">
            <div class="modal-content p-3">
                <div class="row modal-header">
                        <div class="col-sm-12 ml-2">
                            <h4>
                                FECHA DE SUSPENSIÓN
                            </h4>
                        </div>
                </div>

                <div class="row modal-body"
                     [formGroup]="filterModalForm">


                    <div class="col-sm-12">
                        <span>RAMO (*)</span>
                        <select [disabled]="isEdit"
                                class="form-control"
                                formControlName="P_BRANCH_MODAL"
                                [ngClass]="{'error-validate': submittedModal && (!filterModalForm.controls.P_BRANCH_MODAL.valid || filterModalForm.hasError('required'))}">
                            <option value=""
                                    disabled>SELECCIONE RAMO</option>
                            <option *ngFor="let item of ramos.result"
                                    value="{{ item.BRANCH }}">{{ item.DESCRIPT }}</option>
                        </select>
                        <ng-container [ngSwitch]="true"
                                      *ngIf="submittedModal && (!filterModalForm.controls.P_BRANCH_MODAL.valid || filterModalForm.hasError('required')) && !filterModalForm.valid">
                            <span *ngSwitchCase="filterModalForm.get('P_BRANCH_MODAL').hasError('required')"
                                  class="mensaje-error-control">
                                El Ramo es requerido.
                            </span>
                        </ng-container>
                    </div>

                    <div class="col-sm-6">
                        <span>MES</span>
                        <select class="form-control"
                                (change)="onDateChangeModal()"
                                formControlName="P_MONTH_MODAL"
                                [ngClass]="{'error-validate': submittedModal && (!filterModalForm.controls.P_MONTH_MODAL.valid || filterModalForm.hasError('required'))}">
                            <option *ngFor="let item of Months"
                                    value="{{ item.mes }}">{{ item.descripcion }}</option>
                        </select>
                        <ng-container [ngSwitch]="true"
                                      *ngIf="submittedModal && (!filterModalForm.controls.P_MONTH_MODAL.valid || filterModalForm.hasError('required')) && !filterModalForm.valid">
                            <span *ngSwitchCase="filterModalForm.get('P_MONTH_MODAL').hasError('required')"
                                  class="mensaje-error-control">
                                El Mes es requerido.
                            </span>
                        </ng-container>
                    </div>

                    <div class="col-sm-6">
                        <span>AÑO</span>
                        <input type="text"
                               (onHidden)="onDateChangeModal()"
                               formControlName="P_YEAR_MODAL"
                               placeholder="Selecciona un año de búsqueda"
                               bsDatepicker
                               [ngClass]="{'error-validate': submittedModal && (!filterModalForm.controls.P_YEAR_MODAL.valid || filterModalForm.hasError('required'))}"
                               [bsConfig]="bsConfigYear">

                        <ng-container [ngSwitch]="true"
                                      *ngIf="submittedModal && (!filterModalForm.controls.P_YEAR_MODAL.valid || filterModalForm.hasError('required')) && !filterModalForm.valid">
                            <span *ngSwitchCase="filterModalForm.get('P_YEAR_MODAL').hasError('required')"
                                  class="mensaje-error-control">
                                El año es requerido.
                            </span>
                        </ng-container>
                    </div>

                    <div class="col-sm-6">
                        <span>FECHA INICIO (*)</span>
                        <input type="text"
                               formControlName="P_DSTARTDATE"
                               bsDatepicker
                               [ngClass]="{'error-validate': submittedModal && (!filterModalForm.controls.P_DSTARTDATE.valid || filterModalForm.hasError('datesNotSortedCorrectly')|| filterModalForm.hasError('datesIsEquals') || filterModalForm.hasError('dateMinorValidate') )}"
                               [bsConfig]="bsConfigDate"
                               [minDate]="DstartDateModal"
                               [maxDate]="DendDateModal">
                        <ng-container [ngSwitch]="true"
                                      *ngIf="submittedModal && (filterModalForm.get('P_DSTARTDATE').invalid || filterModalForm.hasError('datesNotSortedCorrectly') || filterModalForm.hasError('datesIsEquals') || filterModalForm.hasError('dateMinorValidate'))">
                            <span *ngSwitchCase="filterModalForm.get('P_DSTARTDATE').hasError('required')"
                                  class="mensaje-error-control">
                                La fecha de inicio es requerida.
                            </span>
                            <span *ngSwitchCase="filterModalForm.hasError('datesNotSortedCorrectly')"
                                  class="mensaje-error-control">
                                La fecha de inicio debe ser menor a la fecha de fin.
                            </span>
                            <span *ngSwitchCase="filterModalForm.hasError('datesIsEquals')"
                                  class="mensaje-error-control">
                                La fecha de inicio no puede ser igual a la fecha de fin.
                            </span>
                            <span *ngSwitchCase="filterModalForm.hasError('dateMinorValidate')"
                                  class="mensaje-error-control">
                                La fecha de inicio no puede ser menor a la fecha actual.
                            </span>
                        </ng-container>
                    </div>

                    <div class="col-sm-6">
                        <span>HORA</span>
                        <input type="time"
                               formControlName="P_HOURINI_MODAL"
                               step="300"
                               [ngClass]="{'error-validate': submittedModal && (!filterModalForm.controls.P_HOURINI_MODAL.valid || filterModalForm.hasError('required'))}"
                               class="form-control" />
                        <ng-container [ngSwitch]="true"
                                      *ngIf="submittedModal && (!filterModalForm.controls.P_HOURINI_MODAL.valid || filterModalForm.hasError('required')) && !filterModalForm.valid">
                            <span *ngSwitchCase="filterModalForm.get('P_HOURINI_MODAL').hasError('required')"
                                  class="mensaje-error-control">
                                La hora de inicio es requerida.
                            </span>
                        </ng-container>
                    </div>

                    <div class="col-sm-6">
                        <span>FECHA FIN</span>
                        <input type="text"
                               class="form-control"
                               disabled
                               formControlName="P_DEXPIRDAT"
                               bsDatepicker
                               [ngClass]="{'error-validate': submittedModal && (!filterModalForm.controls.P_DEXPIRDAT.valid || filterModalForm.hasError('datesNotSortedCorrectly') || filterModalForm.hasError('datesIsEquals'))}"
                               [bsConfig]="bsConfigDate"
                               [minDate]="DstartDateModal"
                               [maxDate]="DendDateModal">

                        <ng-container [ngSwitch]="true"
                                      *ngIf="submittedModal && (filterModalForm.get('P_DEXPIRDAT').invalid || filterModalForm.hasError('datesNotSortedCorrectly') || filterModalForm.hasError('datesIsEquals'))">
                            <span *ngSwitchCase="filterModalForm.get('P_DEXPIRDAT').hasError('required')"
                                  class="mensaje-error-control">
                                La fecha de fin es requerida.
                            </span>
                            <span *ngSwitchCase="filterModalForm.hasError('datesNotSortedCorrectly')"
                                  class="mensaje-error-control">
                                La fecha de fin debe ser mayor a la fecha de inicio.
                            </span>
                            <span *ngSwitchCase="filterModalForm.hasError('datesIsEquals')"
                                  class="mensaje-error-control">
                                La fecha de fin no debe ser igual a la fecha de inicio.
                            </span>
                        </ng-container>
                    </div>

                    <div class="col-sm-6">
                        <span>HORA</span>
                        <input type="time"
                               class="form-control"
                               disabled
                               formControlName="P_HOURFIN_MODAL"
                               step="300"
                               [ngClass]="{'error-validate': submittedModal && (!filterModalForm.controls.P_HOURFIN_MODAL.valid || filterModalForm.hasError('required'))}" />
                        <ng-container
                                      *ngIf="submittedModal && (!filterModalForm.controls.P_HOURFIN_MODAL.valid || filterModalForm.hasError('required')) && !filterModalForm.valid">
                            <span *ngIf="filterModalForm.get('P_HOURFIN_MODAL').hasError('required')"
                                  class="mensaje-error-control">
                                La hora final es requerida.
                            </span>
                        </ng-container>
                    </div>



                </div>
                <hr>

                <div class="modal-footer d-flex flex-nowrap justify-content-end align-items-center gap-2 p-0 pt-3 p-2 ">

                    <button class="buttonN "
                            (click)="closeModalMensaje()">
                        <span>Cancelar</span>
                    </button>

                    <button class="buttonN ml-2"
                            type="button"
                            (click)="GenerateTransac()">
                        <span>Guardar</span>
                    </button>

                    <button *ngIf="isEdit && isActive"
                            class="buttonN ml-2"
                            type="button"
                            (click)="CloseDeleteSuspension(false)">
                        <span class="m-0">Cerrar Período</span>
                    </button>

                </div>

            </div>
        </div>
    </div>

</div>

<!-- Pantalla de carga -->
<div [hidden]="isLoading==false"
     class="loadingScreen">
    <div style="display:flex;height: 100%;width:100%">
        <i style="margin:auto;font-size: 50px"
           class="fa fa-spinner fa-spin"></i>
    </div>
</div>